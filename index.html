<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>STEVINCHI — Tienda de Ropa</title>
  <meta name="description" content="STEVINCHI — ropa urbana & básicos. Compra fácil por WhatsApp." />

  <style>
    :root{
      --bg:#f4f4f4;
      --panel:#ffffff;
      --ink:#0f0f0f;
      --muted:#6f6f6f;
      --line:rgba(15,15,15,.10);
      --soft:rgba(15,15,15,.06);
      --accent:#0f0f0f;
      --radius:10px;
      --max:1180px;
      --shadow:none;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:var(--font);
      background: var(--bg);
      color:var(--ink);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      letter-spacing:.01em;
    }
    a{ color:inherit; text-decoration:none; }
    .container{ width:min(var(--max), calc(100% - 44px)); margin:0 auto; }

    /* ===== Header ===== */
    header{
      position:sticky; top:0; z-index:50;
      background: color-mix(in srgb, var(--bg) 88%, #fff 12%);
      border-bottom:1px solid var(--line);
      backdrop-filter: blur(10px);
    }
    .top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      padding:14px 0;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:800;
      letter-spacing:.22em;
      text-transform:uppercase;
    }
    .dot{
      width:10px; height:10px; border-radius:50%;
      background: var(--ink);
    }

    .nav{
      display:flex; align-items:center; gap:18px;
      color:var(--muted);
      font-size:12px;
      letter-spacing:.16em;
      text-transform:uppercase;
      white-space:nowrap;
      overflow:auto;
      scrollbar-width: none;
    }
    .nav::-webkit-scrollbar{ display:none; }
    .nav a{
      padding:10px 0;
      border-bottom:1px solid transparent;
    }
    .nav a:hover{
      color:var(--ink);
      border-bottom-color: var(--ink);
    }

    .actions{
      display:flex; align-items:center; gap:12px;
    }
    .iconbtn{
      width:38px; height:38px;
      border-radius:999px;
      border:1px solid var(--line);
      background: var(--panel);
      display:grid; place-items:center;
      cursor:pointer;
      user-select:none;
    }
    .iconbtn:hover{ border-color: rgba(15,15,15,.22); }
    .count{
      min-width:18px;
      height:18px;
      padding:0 6px;
      border-radius:999px;
      background: var(--ink);
      color:#fff;
      font-size:11px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      margin-left:6px;
      letter-spacing:0;
    }

    /* ===== Subbar ===== */
    .subbar{
      border-top:1px solid var(--line);
      background: var(--panel);
    }
    .sub{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      padding:10px 0;
      flex-wrap:wrap;
    }
    .lefttools, .righttools{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
    }
    .label{
      font-size:12px;
      color:var(--muted);
      letter-spacing:.08em;
    }
    .seg{
      display:flex;
      border:1px solid var(--line);
      border-radius:999px;
      overflow:hidden;
      background:#fff;
    }
    .seg button{
      border:0;
      background:transparent;
      padding:8px 10px;
      font-size:12px;
      letter-spacing:.12em;
      text-transform:uppercase;
      cursor:pointer;
      color:var(--muted);
    }
    .seg button.active{
      background: var(--ink);
      color:#fff;
    }
    .field{
      display:flex; align-items:center; gap:10px;
      border:1px solid var(--line);
      background:#fff;
      border-radius:999px;
      padding:9px 12px;
      min-width: 280px;
    }
    .field input{
      border:0; outline:0; width:100%;
      font-size:13px;
      background:transparent;
      color:var(--ink);
    }
    .ghost{
      border:1px solid var(--line);
      background:#fff;
      border-radius:999px;
      padding:9px 12px;
      font-size:12px;
      letter-spacing:.12em;
      text-transform:uppercase;
      cursor:pointer;
      color:var(--ink);
    }
    .ghost:hover{ border-color: rgba(15,15,15,.22); }

    /* ===== Page title ===== */
    .hero{
      padding:26px 0 10px;
    }
    .hero h1{
      margin:0;
      font-size:18px;
      font-weight:700;
      letter-spacing:.20em;
      text-transform:uppercase;
    }
    .hero p{
      margin:10px 0 0;
      color:var(--muted);
      font-size:13px;
      line-height:1.6;
      max-width: 70ch;
    }

    /* ===== Grid ===== */
    main{ padding-bottom:90px; }
    .grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:18px;
      padding:16px 0 24px;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: repeat(2, 1fr); }
      .field{ min-width: 200px; }
    }
    @media (max-width: 640px){
      .grid{ grid-template-columns: 1fr; }
    }

    .card{
      background:transparent;
      border:0;
      border-radius:0;
      overflow:hidden;
      position:relative;
    }
    .img{
      height: 420px;
      background: #efefef;
      border: 1px solid var(--soft);
      position:relative;
      display:grid;
      place-items:center;
      transition: transform .18s ease;
    }
    .card:hover .img{ transform: scale(1.01); }

    /* Placeholder "product silhouette" */
    .ph{
      width:68%;
      height:62%;
      background: #e7e7e7;
      border-radius: 22px;
      position:relative;
      border:1px solid rgba(0,0,0,.04);
    }
    .ph:before{
      content:"";
      position:absolute;
      inset:10% 18% auto 18%;
      height:20%;
      border-radius: 14px;
      background: rgba(0,0,0,.02);
    }
    .ph:after{
      content:"STEVINCHI";
      position:absolute;
      left:0; right:0;
      bottom:10%;
      text-align:center;
      font-size:11px;
      letter-spacing:.28em;
      text-transform:uppercase;
      color: rgba(0,0,0,.25);
      font-weight:700;
    }

    .badge{
      position:absolute;
      top:12px; left:12px;
      background: var(--ink);
      color:#fff;
      font-size:11px;
      letter-spacing:.14em;
      text-transform:uppercase;
      padding:7px 10px;
      border-radius: 6px;
    }
    .badge.light{
      background: rgba(255,255,255,.92);
      color: var(--ink);
      border:1px solid var(--line);
    }

    .meta{
      padding:14px 2px 0;
    }
    .meta .name{
      font-size:12px;
      letter-spacing:.18em;
      text-transform:uppercase;
      font-weight:700;
      line-height:1.4;
    }
    .meta .sub{
      margin-top:6px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:0;
      border:0;
      background:transparent;
      flex-wrap:wrap;
    }
    .meta .cat{
      font-size:11px;
      letter-spacing:.14em;
      text-transform:uppercase;
      color:var(--muted);
    }
    .meta .price{
      font-size:12px;
      letter-spacing:.14em;
      text-transform:uppercase;
      font-weight:700;
    }
    .meta .strike{
      color: var(--muted);
      text-decoration: line-through;
      font-weight:600;
      margin-left:8px;
    }

    /* Hover quick actions */
    .quick{
      position:absolute;
      left:12px; right:12px;
      bottom:12px;
      display:flex;
      gap:10px;
      opacity:0;
      transform: translateY(6px);
      transition: opacity .18s ease, transform .18s ease;
    }
    .card:hover .quick{ opacity:1; transform: translateY(0); }
    .qbtn{
      flex:1;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.92);
      padding:10px 12px;
      font-size:12px;
      letter-spacing:.12em;
      text-transform:uppercase;
      cursor:pointer;
      display:flex; align-items:center; justify-content:center; gap:8px;
      backdrop-filter: blur(8px);
    }
    .qbtn.primary{
      background: var(--ink);
      color:#fff;
      border-color: var(--ink);
    }
    .qbtn:hover{ border-color: rgba(15,15,15,.24); }

    /* ===== Drawer (Filters) ===== */
    .drawerBackdrop{
      position:fixed; inset:0;
      background: rgba(0,0,0,.24);
      display:none;
      z-index:80;
    }
    .drawerBackdrop.open{ display:block; }
    .drawer{
      position:fixed;
      top:0; right:0; bottom:0;
      width:min(420px, calc(100% - 56px));
      background: var(--panel);
      border-left:1px solid var(--line);
      transform: translateX(100%);
      transition: transform .22s ease;
      z-index:90;
      display:flex;
      flex-direction:column;
    }
    .drawer.open{ transform: translateX(0); }
    .drawerHead{
      padding:16px 16px;
      display:flex; align-items:center; justify-content:space-between;
      border-bottom:1px solid var(--line);
    }
    .drawerHead b{
      font-size:12px;
      letter-spacing:.18em;
      text-transform:uppercase;
    }
    .drawerBody{
      padding:16px;
      display:grid;
      gap:14px;
      overflow:auto;
    }
    .group{
      border:1px solid var(--line);
      border-radius: 12px;
      padding:14px;
      background:#fff;
    }
    .group h3{
      margin:0 0 10px;
      font-size:11px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color: var(--muted);
      font-weight:700;
    }
    .chips{ display:flex; gap:8px; flex-wrap:wrap; }
    .chip{
      border:1px solid var(--line);
      background:#fff;
      border-radius:999px;
      padding:8px 10px;
      font-size:11px;
      letter-spacing:.12em;
      text-transform:uppercase;
      cursor:pointer;
      color:var(--ink);
    }
    .chip.active{
      background: var(--ink);
      color:#fff;
      border-color: var(--ink);
    }
    .drawerFoot{
      margin-top:auto;
      padding:14px 16px;
      border-top:1px solid var(--line);
      display:flex; gap:10px;
      background: color-mix(in srgb, var(--panel) 88%, var(--bg) 12%);
    }
    .full{
      flex:1;
      border-radius:999px;
      padding:11px 12px;
      border:1px solid var(--line);
      background:#fff;
      cursor:pointer;
      font-size:12px;
      letter-spacing:.12em;
      text-transform:uppercase;
    }
    .full.primary{
      background: var(--ink);
      color:#fff;
      border-color: var(--ink);
    }

    /* ===== Bag Drawer ===== */
    .bagDrawer .line{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      border:1px solid var(--line);
      border-radius: 12px;
      padding:12px;
      background:#fff;
    }
    .qty{
      display:flex; align-items:center; gap:6px;
      border:1px solid var(--line);
      border-radius:999px;
      padding:6px 8px;
      background:#fff;
    }
    .qty button{
      border:0;
      background:transparent;
      cursor:pointer;
      font-weight:800;
      padding:0 6px;
    }
    .tot{
      display:flex; justify-content:space-between; align-items:center;
      font-size:12px;
      letter-spacing:.14em;
      text-transform:uppercase;
      font-weight:700;
      padding:0 2px;
      margin-top:6px;
    }

    /* ===== Floating WhatsApp ===== */
    .wa{
      position:fixed;
      right:16px;
      bottom:16px;
      z-index:70;
      display:flex;
      align-items:center;
      gap:10px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.94);
      padding:12px 14px;
      border-radius:999px;
      cursor:pointer;
      user-select:none;
      backdrop-filter: blur(10px);
    }
    .wa b{
      font-size:12px;
      letter-spacing:.14em;
      text-transform:uppercase;
    }
    .wa span{
      font-size:12px;
      color:var(--muted);
    }

    /* Footer */
    footer{
      border-top:1px solid var(--line);
      background: var(--panel);
      padding:18px 0;
    }
    .foot{
      display:flex;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
      align-items:center;
      color:var(--muted);
      font-size:12px;
      letter-spacing:.06em;
    }
    .foot a{
      color:var(--ink);
      border-bottom:1px solid rgba(15,15,15,.22);
    }
  </style>
</head>

<body>
  <header>
    <div class="container top">
      <a class="brand" href="#top" aria-label="Inicio STEVINCHI">
        <span class="dot" aria-hidden="true"></span>
        <span>STEVINCHI</span>
      </a>

      <nav class="nav" aria-label="Categorías">
        <a href="#" data-cat="all" class="navcat" aria-current="true">ALL</a>
        <a href="#" data-cat="HOMBRE" class="navcat">HOMBRE</a>
        <a href="#" data-cat="MUJER" class="navcat">MUJER</a>
        <a href="#" data-cat="COLECCIONES" class="navcat">COLECCIONES</a>
        <a href="#" data-cat="BÁSICOS" class="navcat">BÁSICOS</a>
      </nav>

      <div class="actions">
        <button class="iconbtn" id="filterBtn" type="button" aria-label="Filtrar">
          <!-- sliders icon -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M4 7h10M18 7h2M14 7v0M4 17h2M10 17h10M8 17v0M4 12h6M14 12h6M12 12v0" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>

        <button class="iconbtn" id="searchFocusBtn" type="button" aria-label="Buscar">
          <!-- search icon -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>

        <button class="iconbtn" id="bagBtn" type="button" aria-label="Bolsa">
          <!-- bag icon -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M7 8V7a5 5 0 0 1 10 0v1" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M6 8h12l-1 13H7L6 8Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
          </svg>
          <span class="count" id="bagCount">0</span>
        </button>
      </div>
    </div>

    <div class="subbar">
      <div class="container sub">
        <div class="lefttools">
          <span class="label">Vista</span>
          <div class="seg" role="tablist" aria-label="Vista">
            <button type="button" id="view3" class="active" aria-selected="true">GRID</button>
            <button type="button" id="view2" aria-selected="false">WIDE</button>
          </div>
        </div>

        <div class="righttools">
          <div class="field" aria-label="Buscar productos">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <input id="q" placeholder="Buscar…" />
          </div>

          <button class="ghost" id="sortBtn" type="button" aria-label="Ordenar">Ordenar</button>
          <button class="ghost" id="clearFiltersBtn" type="button" aria-label="Limpiar filtros">Limpiar</button>
        </div>
      </div>
    </div>
  </header>

  <main id="top">
    <section class="hero">
      <div class="container">
        <h1>Catálogo</h1>
        <p>
          Bogotá · Pedido por WhatsApp · Instagram:
          <a href="https://www.instagram.com/stevinchi__/" target="_blank" rel="noopener">@stevinchi__</a>
        </p>
      </div>
    </section>

    <section class="container" aria-label="Productos">
      <div class="grid" id="grid"></div>
    </section>
  </main>

  <!-- Backdrop for drawers -->
  <div class="drawerBackdrop" id="backdrop" aria-hidden="true"></div>

  <!-- Filters Drawer -->
  <aside class="drawer" id="filters" aria-label="Filtros">
    <div class="drawerHead">
      <b>Filtrar</b>
      <button class="iconbtn" id="closeFilters" type="button" aria-label="Cerrar filtros">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M6 6l12 12M18 6 6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>

    <div class="drawerBody">
      <div class="group">
        <h3>Categoría producto</h3>
        <div class="chips" id="catChips"></div>
      </div>

      <div class="group">
        <h3>Etiquetas</h3>
        <div class="chips" id="tagChips"></div>
      </div>

      <div class="group">
        <h3>Precio</h3>
        <div class="chips">
          <button class="chip" data-price="all" type="button">ALL</button>
          <button class="chip" data-price="low" type="button">≤ 80K</button>
          <button class="chip" data-price="mid" type="button">80K–140K</button>
          <button class="chip" data-price="high" type="button">≥ 140K</button>
        </div>
      </div>
    </div>

    <div class="drawerFoot">
      <button class="full" id="resetBtn" type="button">Reset</button>
      <button class="full primary" id="applyBtn" type="button">Aplicar</button>
    </div>
  </aside>

  <!-- Bag Drawer -->
  <aside class="drawer bagDrawer" id="bag" aria-label="Bolsa">
    <div class="drawerHead">
      <b>Bolsa</b>
      <button class="iconbtn" id="closeBag" type="button" aria-label="Cerrar bolsa">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M6 6l12 12M18 6 6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>

    <div class="drawerBody" id="bagBody">
      <div style="color:var(--muted); font-size:13px; line-height:1.6;">
        Tu bolsa está vacía. Agrega productos desde el catálogo.
      </div>
    </div>

    <div class="drawerFoot">
      <button class="full" id="bagClear" type="button">Vaciar</button>
      <button class="full primary" id="bagCheckout" type="button">WhatsApp</button>
    </div>
  </aside>

  <!-- WhatsApp Floating -->
  <button class="wa" id="waFloat" type="button" aria-label="WhatsApp">
    <b>WhatsApp</b>
    <span>Pedido</span>
  </button>

  <footer>
    <div class="container foot">
      <div>© <span id="year"></span> STEVINCHI · Bogotá</div>
      <div>
        <a href="https://www.instagram.com/stevinchi__/" target="_blank" rel="noopener">Instagram</a>
        &nbsp;·&nbsp;
        <a href="#" id="waFooter" onclick="return false;">WhatsApp</a>
      </div>
    </div>
  </footer>

  <script>
    // =========================
    // CONFIG (YA LISTO)
    // =========================
    const WHATSAPP_NUMBER = "573224322107"; // 57 + 3224322107
    const STORE_NAME = "STEVINCHI";
    const CITY = "Bogotá";
    const INSTAGRAM_URL = "https://www.instagram.com/stevinchi__/";

    // =========================
    // PRODUCTOS (EDITAS DESPUÉS)
    // Para estilo "UNDERGOLD", usaremos placeholders por ahora.
    // Luego, cuando tengas fotos, añadimos: image:"img/xxx.jpg"
    // =========================
    const PRODUCTS = [
      { id:"p1", name:"Basics Boxy Fit Tshirt White", price: 250000, category:"BÁSICOS", prodCat:"Camisetas", tags:["SALE"], salePrice: 161000 },
      { id:"p2", name:"Basics Peached Tshirt Black", price: 230000, category:"BÁSICOS", prodCat:"Camisetas", tags:["SALE"], salePrice: 161000 },
      { id:"p3", name:"Basics Peached Tshirt White", price: 230000, category:"BÁSICOS", prodCat:"Camisetas", tags:["SALE"], salePrice: 161000 },
      { id:"p4", name:"Hoodie Minimal Logo", price: 149000, category:"COLECCIONES", prodCat:"Hoodies", tags:["NEW"] },
      { id:"p5", name:"Cargo Street Pant", price: 139000, category:"HOMBRE", prodCat:"Pantalones", tags:["TOP"] },
      { id:"p6", name:"Cap Minimal", price: 49000, category:"ALL", prodCat:"Accesorios", tags:["TOP"] },
      { id:"p7", name:"Oversize Essential Tee", price: 79000, category:"MUJER", prodCat:"Camisetas", tags:["NEW"] },
      { id:"p8", name:"Oversize Basic Hoodie", price: 129000, category:"ALL", prodCat:"Hoodies", tags:["BASIC"] },
      { id:"p9", name:"Signature Tee Black", price: 89000, category:"COLECCIONES", prodCat:"Camisetas", tags:["DROP"] }
    ];

    // =========================
    // STATE (filtros)
    // =========================
    const state = {
      topCategory: "all",   // ALL / HOMBRE / MUJER / COLECCIONES / BÁSICOS
      prodCat: "all",       // Camisetas / Hoodies / Pantalones / Accesorios
      tag: "all",           // SALE / NEW / etc
      priceBand: "all",     // low/mid/high
      query: "",
      wide: false,
      sort: "reco",         // reco/low/high
    };

    // Bolsa (bag)
    const bag = new Map(); // id -> qty

    // =========================
    // HELPERS
    // =========================
    const $ = (id) => document.getElementById(id);
    const money = (n) => n.toLocaleString("es-CO", { style:"currency", currency:"COP", maximumFractionDigits:0 });

    function waUrl(text){
      return `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(text)}`;
    }

    function orderText(singleId=null){
      const lines = [];
      lines.push(`Hola! Quiero hacer un pedido en ${STORE_NAME}.`);
      lines.push(`Ciudad: ${CITY}`);
      lines.push("");

      if (singleId){
        const p = PRODUCTS.find(x=>x.id===singleId);
        if (p){
          lines.push(`Producto: ${p.name}`);
          lines.push(`Precio: ${p.tags.includes("SALE") && p.salePrice ? money(p.salePrice) : money(p.price)}`);
          lines.push(`Cantidad: 1`);
        }
      } else {
        if (bag.size === 0){
          lines.push("(Aún no tengo productos en la bolsa)");
        } else {
          lines.push("Mi bolsa:");
          for (const [id, qty] of bag.entries()){
            const p = PRODUCTS.find(x=>x.id===id);
            if (!p) continue;
            const unit = (p.tags.includes("SALE") && p.salePrice) ? p.salePrice : p.price;
            lines.push(`- ${p.name} x${qty} (${money(unit * qty)})`);
          }
          lines.push("");
          lines.push(`Total: ${money(bagTotal())}`);
        }
      }

      lines.push("");
      lines.push("¿Me confirmas disponibilidad, tallas y envío?");

      return lines.join("\n");
    }

    function bagCount(){
      let c = 0;
      for (const v of bag.values()) c += v;
      return c;
    }

    function bagTotal(){
      let t = 0;
      for (const [id, qty] of bag.entries()){
        const p = PRODUCTS.find(x=>x.id===id);
        if (!p) continue;
        const unit = (p.tags.includes("SALE") && p.salePrice) ? p.salePrice : p.price;
        t += unit * qty;
      }
      return t;
    }

    function setActive(el, selector){
      document.querySelectorAll(selector).forEach(x=>x.classList.remove("active"));
      el.classList.add("active");
    }

    // =========================
    // RENDER GRID
    // =========================
    function passesPrice(p){
      const v = (p.tags.includes("SALE") && p.salePrice) ? p.salePrice : p.price;
      if (state.priceBand === "low") return v <= 80000;
      if (state.priceBand === "mid") return v > 80000 && v < 140000;
      if (state.priceBand === "high") return v >= 140000;
      return true;
    }

    function filtered(){
      const q = state.query.trim().toLowerCase();
      let list = PRODUCTS.filter(p => {
        const topOk = (state.topCategory === "all") ? true : (p.category === state.topCategory || p.category === "ALL");
        const prodCatOk = (state.prodCat === "all") ? true : (p.prodCat === state.prodCat);
        const tagOk = (state.tag === "all") ? true : p.tags.includes(state.tag);
        const qOk = !q ? true : (p.name.toLowerCase().includes(q) || (p.prodCat||"").toLowerCase().includes(q) || (p.category||"").toLowerCase().includes(q));
        return topOk && prodCatOk && tagOk && qOk && passesPrice(p);
      });

      if (state.sort === "low") list.sort((a,b)=>((a.salePrice||a.price)-(b.salePrice||b.price)));
      if (state.sort === "high") list.sort((a,b)=>((b.salePrice||b.price)-(a.salePrice||a.price)));
      return list;
    }

    function productCard(p){
      const isSale = p.tags.includes("SALE") && p.salePrice;
      const badge = isSale ? `<span class="badge">SALE</span>` : (p.tags.includes("NEW") ? `<span class="badge light">NEW</span>` : "");
      const priceHtml = isSale
        ? `<span class="price">${money(p.salePrice)}</span><span class="strike">${money(p.price)}</span>`
        : `<span class="price">${money(p.price)}</span>`;

      return `
        <article class="card" aria-label="${p.name}">
          <div class="img">
            ${badge}
            <div class="ph" aria-hidden="true"></div>

            <div class="quick" aria-hidden="true">
              <button class="qbtn" type="button" onclick="addToBag('${p.id}')">ADD</button>
              <button class="qbtn primary" type="button" onclick="buyNow('${p.id}')">WHATSAPP</button>
            </div>
          </div>

          <div class="meta">
            <div class="name">${p.name}</div>
            <div class="sub">
              <div class="cat">${p.prodCat} · ${p.category}</div>
              <div>${priceHtml}</div>
            </div>
          </div>
        </article>
      `;
    }

    function render(){
      const g = $("grid");
      const list = filtered();
      g.innerHTML = list.map(productCard).join("");

      // Toggle wide mode
      g.style.gridTemplateColumns = state.wide ? "repeat(2, 1fr)" : "";
      if (window.innerWidth <= 640) g.style.gridTemplateColumns = "1fr";
    }

    // =========================
    // FILTER DRAWER (chips)
    // =========================
    function unique(arr){ return Array.from(new Set(arr)); }

    function renderChips(){
      // prodCat chips
      const cats = unique(PRODUCTS.map(p=>p.prodCat)).filter(Boolean);
      $("catChips").innerHTML = [
        `<button class="chip ${state.prodCat==="all"?"active":""}" data-prodc="all" type="button">ALL</button>`,
        ...cats.map(c=>`<button class="chip ${state.prodCat===c?"active":""}" data-prodc="${c}" type="button">${c}</button>`)
      ].join("");

      // tag chips
      const tags = unique(PRODUCTS.flatMap(p=>p.tags || [])).filter(Boolean);
      $("tagChips").innerHTML = [
        `<button class="chip ${state.tag==="all"?"active":""}" data-tag="all" type="button">ALL</button>`,
        ...tags.map(t=>`<button class="chip ${state.tag===t?"active":""}" data-tag="${t}" type="button">${t}</button>`)
      ].join("");

      // price chips state
      document.querySelectorAll('[data-price]').forEach(btn=>{
        btn.classList.toggle("active", btn.dataset.price === state.priceBand);
      });

      // Attach events
      $("catChips").querySelectorAll("[data-prodc]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          $("catChips").querySelectorAll(".chip").forEach(x=>x.classList.remove("active"));
          btn.classList.add("active");
          state.prodCat = btn.dataset.prodc;
        });
      });

      $("tagChips").querySelectorAll("[data-tag]").forEach(btn=>{
        $("tagChips").querySelectorAll(".chip").forEach(x=>x.classList.remove("active"));
        btn.classList.add("active");
        state.tag = btn.dataset.tag;
      });

      document.querySelectorAll("[data-price]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          document.querySelectorAll("[data-price]").forEach(x=>x.classList.remove("active"));
          btn.classList.add("active");
          state.priceBand = btn.dataset.price;
        });
      });
    }

    // =========================
    // DRAWERS
    // =========================
    const backdrop = $("backdrop");
    const filters = $("filters");
    const bagDrawer = $("bag");

    function openDrawer(which){
      backdrop.classList.add("open");
      if (which === "filters") filters.classList.add("open");
      if (which === "bag") bagDrawer.classList.add("open");
      backdrop.setAttribute("aria-hidden","false");
    }
    function closeDrawers(){
      filters.classList.remove("open");
      bagDrawer.classList.remove("open");
      backdrop.classList.remove("open");
      backdrop.setAttribute("aria-hidden","true");
    }
    backdrop.addEventListener("click", closeDrawers);
    $("closeFilters").addEventListener("click", closeDrawers);
    $("closeBag").addEventListener("click", closeDrawers);

    $("filterBtn").addEventListener("click", ()=>{
      renderChips();
      openDrawer("filters");
    });
    $("bagBtn").addEventListener("click", ()=>{
      syncBag();
      openDrawer("bag");
    });

    // Apply/reset filters
    $("applyBtn").addEventListener("click", ()=>{
      closeDrawers();
      render();
    });
    $("resetBtn").addEventListener("click", ()=>{
      state.prodCat = "all";
      state.tag = "all";
      state.priceBand = "all";
      renderChips();
    });

    // Top nav category
    document.querySelectorAll(".navcat").forEach(a=>{
      a.addEventListener("click", (e)=>{
        e.preventDefault();
        document.querySelectorAll(".navcat").forEach(x=>{
          x.style.color = "";
          x.style.borderBottomColor = "transparent";
          x.setAttribute("aria-current","false");
        });
        a.style.color = "var(--ink)";
        a.style.borderBottomColor = "var(--ink)";
        a.setAttribute("aria-current","true");

        state.topCategory = a.dataset.cat === "all" ? "all" : a.dataset.cat;
        render();
      });
    });

    // Search
    $("q").addEventListener("input", ()=>{
      state.query = $("q").value;
      render();
    });
    $("searchFocusBtn").addEventListener("click", ()=>{
      $("q").focus();
    });

    // View toggle
    $("view3").addEventListener("click", ()=>{
      setActive($("view3"), ".seg button");
      state.wide = false;
      render();
    });
    $("view2").addEventListener("click", ()=>{
      setActive($("view2"), ".seg button");
      state.wide = true;
      render();
    });

    // Sort button (simple cycle)
    $("sortBtn").addEventListener("click", ()=>{
      if (state.sort === "reco") state.sort = "low";
      else if (state.sort === "low") state.sort = "high";
      else state.sort = "reco";
      $("sortBtn").textContent = state.sort === "reco" ? "Ordenar" : (state.sort === "low" ? "Precio ↑" : "Precio ↓");
      render();
    });

    // Clear all
    $("clearFiltersBtn").addEventListener("click", ()=>{
      state.topCategory = "all";
      state.prodCat = "all";
      state.tag = "all";
      state.priceBand = "all";
      state.query = "";
      state.sort = "reco";
      $("sortBtn").textContent = "Ordenar";
      $("q").value = "";
      document.querySelectorAll(".navcat").forEach(x=>{
        x.style.color="";
        x.style.borderBottomColor="transparent";
        x.setAttribute("aria-current","false");
      });
      // mark ALL as active
      const all = document.querySelector('.navcat[data-cat="all"]');
      if (all){
        all.style.color="var(--ink)";
        all.style.borderBottomColor="var(--ink)";
        all.setAttribute("aria-current","true");
      }
      render();
    });

    // =========================
    // BAG (add/checkout)
    // =========================
    function syncBag(){
      $("bagCount").textContent = bagCount();
      const body = $("bagBody");

      if (bag.size === 0){
        body.innerHTML = `<div style="color:var(--muted); font-size:13px; line-height:1.6;">Tu bolsa está vacía. Agrega productos desde el catálogo.</div>`;
        return;
      }

      const lines = Array.from(bag.entries()).map(([id, qty])=>{
        const p = PRODUCTS.find(x=>x.id===id);
        if (!p) return "";
        const unit = (p.tags.includes("SALE") && p.salePrice) ? p.salePrice : p.price;
        return `
          <div class="line">
            <div>
              <div style="font-size:12px; letter-spacing:.12em; text-transform:uppercase; font-weight:700; line-height:1.4;">${p.name}</div>
              <div style="margin-top:6px; color:var(--muted); font-size:12px; letter-spacing:.10em; text-transform:uppercase;">
                ${p.prodCat} · ${money(unit)}
              </div>
            </div>

            <div style="display:flex; flex-direction:column; align-items:flex-end; gap:8px;">
              <div class="qty">
                <button type="button" onclick="decBag('${id}')" aria-label="Quitar">−</button>
                <span style="min-width:18px; text-align:center; font-weight:800;">${qty}</span>
                <button type="button" onclick="incBag('${id}')" aria-label="Agregar">+</button>
              </div>
              <div style="font-size:12px; letter-spacing:.12em; text-transform:uppercase; font-weight:800;">
                ${money(unit * qty)}
              </div>
            </div>
          </div>
        `;
      }).join("");

      body.innerHTML = `
        ${lines}
        <div class="tot">
          <span>Total</span>
          <span>${money(bagTotal())}</span>
        </div>
      `;
    }

    window.addToBag = (id)=>{
      bag.set(id, (bag.get(id)||0) + 1);
      syncBag();
      openDrawer("bag");
    };
    window.incBag = (id)=>{
      bag.set(id, (bag.get(id)||0) + 1);
      syncBag();
    };
    window.decBag = (id)=>{
      const q = bag.get(id)||0;
      if (q<=1) bag.delete(id);
      else bag.set(id, q-1);
      syncBag();
    };

    $("bagClear").addEventListener("click", ()=>{
      bag.clear();
      syncBag();
    });

    window.buyNow = (id)=>{
      window.open(waUrl(orderText(id)), "_blank");
    };

    $("bagCheckout").addEventListener("click", ()=>{
      window.open(waUrl(orderText()), "_blank");
    });

    // WhatsApp floating + footer
    $("waFloat").addEventListener("click", ()=>{
      window.open(waUrl(`Hola! Vengo de la web de ${STORE_NAME} y quiero hacer un pedido.`), "_blank");
    });
    $("waFooter").addEventListener("click", ()=>{
      window.open(waUrl(`Hola! Vengo de Instagram / la web de ${STORE_NAME}. ¿Me ayudas con un pedido?`), "_blank");
    });

    // Footer year
    $("year").textContent = new Date().getFullYear();

    // Initial "ALL" underline
    (() => {
      const all = document.querySelector('.navcat[data-cat="all"]');
      if (all){
        all.style.color="var(--ink)";
        all.style.borderBottomColor="var(--ink)";
        all.setAttribute("aria-current","true");
      }
      render();
      syncBag();
      // Chip default active for price band
      document.querySelectorAll('[data-price="all"]').forEach(btn=>btn.classList.add("active"));
    })();
  </script>
</body>
</html>

